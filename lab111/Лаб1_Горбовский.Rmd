---
title: "Лабораторная работа №1"
author: "Горбовский А.А."
date: "30 11 2020"
output: word_document
---

```{r setup, include=FALSE}
# Загрузка библиотек
library('Hmisc') # для расчёта корреляционной матрицы
library('corrplot') # визуализация корреляционных матриц
library('knitr') # для генерации отчёта
library('nortest') # тест на нормальность: ad.test()
knitr::opts_chunk$set(echo = FALSE)

```

# Раздел I.
В этом разделе необходимо собрать данные по социально-экономическим показателям в регионах РФ и изучить их взаимосвязи.

**Необходимо построить:**

* Гистограммы распределения с наложенными теоретическими кривыми плотности нормального закона, разместить графики на одном полотне.

* Тест Андерсона-Дарлинга на нормальность: таблица со статистикой теста, критическим значением и выводом по каждой переменной.

* Точечные графики взаимного разброса (?pairs), сделать маркеры полупрозрачными.

* Взаимосвязь показателей: графическое представление корреляционной матрицы с помощью функции corrplot(). Незначимые коэффициенты корреляции скрыть, остальные показать числами.

### Обозначения количественных показателей:

* *"Y.activity.2016.ps"* – Объем отгруженных товаров собственного производства, выполненных работ и услуг собственными силами по видам экономической деятельности: обрабатывающие производства

* *"INDEX.p.2016"* – Индексы цен производителей промышленных товаров по видам экономической деятельности: обрабатывающие производства
numb.employees.2016 – Изменение среднегодовой численности занятых

* *"numb.employees.2016"* – Изменение среднегодовой численности занятых

* *"INDEX.VRP.2015"*  – Индекс физического объема ВРП

* *"Sum.activity.2015"* – Сумма убытка организаций по отдельным видам экономической деятельности: обрабатывающие производства

# 1. Импорт данных

```{r import}
# 1. Импорт данных  
DF <- read.table('Горбовский-Александр-9.csv',
                 header = T, # заголовок в первой строке
                 dec = ',', # разделитель целой и дробной части
                 sep = ';', # разделитель значений в строке
                 row.names = 1, # первый столбец – названия наблюдений
                 as.is = T, # не делать факторы
                 na.strings = 'NA') # символы пропущенных значений

# делаем из столбца "FO" фактор
DF$FO <- as.factor(DF$FO)

# оставляем только регионы и выбрасываем столбец меток,
# чтобы удобнее было считать
reg.df <- DF[as.numeric(row.names(DF)) < 1000, -1]

# выбрасываем пропущенные
reg.df <- na.omit(reg.df)

```

Файл с данными содержит 96 строк и 7 столбцов

## 2. Описательные статистики

```{r}
# ручной расчёт
#  средние арифметические
mns <- round(apply(reg.df[, -1], 2, mean), 1)
#  стандартные отклонения
sds <- round(apply(reg.df[, -1], 2, sd), 1)
#  коэффициенты вариации
coef.vars <- round(sds / mns * 100, 1)
# делаем свою таблицу только с нужными статистиками 
#  по количественным показателям: среднее, СКО, коэффициент вариации
smm <- rbind(mns, sds, coef.vars)
# названия статистик -- заголовки строк
row.names(smm) <- c('Среднее', 'Стандартное отклонение',
                    'Коэффициент вариации, %')
kable(smm)

```

**Вывод:** показатели не однородны, кроме *INDEX.p.2016*, *INDEX.VRP.2015*

## 3. Анализ распределения данных
# Гистограммы

```{r}
# строим гистограммы на одном полотне
par(mfrow = c(2, 3)) # разбить полотно на 6 частей, 2x3
par(oma = c(0, 0, 1.5, 0)) # внешние поля общего полотна
par(mar = c(4, 4, 0.5, 0.5)) # внутренние поля каждого графика

# цикл по номерам столбцов с количественными переменными
for (i in 2:6) {
  # данные -- i-ый столбец фрейма
  x <- reg.df[, i]
  
  # гистограмма
  hist(x,
       freq = F, # по вертикали – плотность (доля)
       col = 'wheat', # цвет заливки
       xlab = colnames(reg.df)[i], # ось X – название столбца
       ylab = 'Плотность', # ось Y
       main = '') # без заголовка
  
  # теоретическая плотность
  curve(dnorm(x, mean = mean(x), sd = sd(x)), col = 'darkblue',
        lwd = 2, add = TRUE)}

# общий заголовок для всех графиков
title(main = 'Гистограммы распределения показателей',
      outer = TRUE, cex = 1.5)

# вернуть настройки обратно, 1x1
par(mfrow = c(1, 1))
```

**Вывод:** Судя по гистограммам, распределения всех показателей ассиметричны по сравнению с нормальным законом.(Особенно это заметно у *"Y.activity.2016.ps"*, *"numb.employees.2016"*,*"Sum.activity.2015"*) Кроме того, показатели имеют более островершинные распределения по сравнению с нормальным законом.

## Тест Андерсона-Дарлинга на нормальность распределения

```{r}

# применяем ко всем столбцам тест Андерсона-Дарлинга и вытаскиваем только тестовую статистику
# для изначальных значений
W <- sapply(reg.df[, 2:6], function(x) {
  round(ad.test(x)$statistic, 4)
})
p <- sapply(reg.df[, 2:6], function(x) {
  round(ad.test(x)$p.value, 4)
})
table <- data.frame(W, p)
kable(table)
```

**Вывод:**: По итогам теста Андерсона-Дарлинга на нормальность распредления переменных (при уровне значимости 0,05) отвергается нулевая гипотеза о нормальности распределения, т.к. P-значения < 0.05. 

## 4. Анализ линейных взаимосвязей 
# Графики разброса

```{r}
# графики взаимного разброса
pairs(reg.df[, -1], # фрейм без первого столбца-фактора
      pch = 21, # тип символов для точек
      col = rgb(0, 0, 1, alpha = 0.4), # цвет заливки точек
      bg = rgb(0, 0, 1, alpha = 0.4), # цвет границы точек
      cex = 1.1) # масштаб символов для точек

```

**Вывод:** по первой строке графиков попытаемся определить наличие связи между *Y.activity.2016.ps* и остальными показателями. Скорее всего связь отсутствует со всеми показателями, но возможны слабые связи.

# Корреляционная матрица

```{r}
# коэффициенты Пирсона с P-значениями
r.corr <- rcorr(as.matrix(reg.df[, -1]))
```

# Визуализация корреляционной матрицы

```{r}
# сохраняем корреляционную матрицу
matrix.cor <- cor(reg.df[, -1])

# сохраняем p-значения
matrix.p <- rcorr(as.matrix(reg.df[, -1]))$P

# изображаем матрицу графически
corrplot(matrix.cor, method = "number",        # сама корреляционная матрица
         order = 'original',  # порядок отображения показателей 
         # в матрице
         diag = F,            # не отображать значения на главной 
         # диагонали
         p.mat = matrix.p,    # p-значения
         insig = 'blank',     # метод отображения незначимых
         sig.level = 0.05)    # уровень значимости
title(ylab = 'Корреляция показателей')
```

**Вывод:** Взаимосвязь *Y.activity.2016.ps* значима с показателями *numb.employees.2016* и *Sum.activity.2015*.

# Раздел II
## Описательная статистика логарифмированных данных:

```{r}
#фрейм с логарифмированными данными
DFF <- reg.df
DFF$Y.activity.2016.ps <- log(reg.df$Y.activity.2016.ps)
DFF$INDEX.p.2016 <- log(reg.df$INDEX.p.2016)
DFF$numb.employees.2016 <- log(reg.df$numb.employees.2016)
DFF$INDEX.VRP.2015 <- log(reg.df$INDEX.VRP.2015)
DFF$Sum.activity.2015 <- log(reg.df$Sum.activity.2015)

# ручной расчёт
#  средние арифметические
mns1 <- round(apply(DFF[, -1], 2, mean), 3)

#  стандартные отклонения
sds1 <- round(apply(DFF[, -1], 2, sd), 3)

#  коэффициенты вариации
coef.vars1 <- round(sds1 / mns1 * 100, 3)

# делаем свою таблицу только с нужными статистиками 
#  по количественным показателям: среднее, СКО, коэффициент вариации
smm1 <- rbind(mns1, sds1, coef.vars1)

# названия статистик -- заголовки строк
row.names(smm1) <- c('Среднее', 'Стандартное отклонение',
                    'Коэффициент вариации, %')
kable(smm1)
```

**Вывод:** *Y.activity.2016.ps*, *numb.employees*, *Sum.activity.2015* показатели не однородны

## Анализ распределения данных
# Гистограммы

```{r}
# строим гистограммы на одном полотне
par(mfrow = c(2, 3)) # разбить полотно на 6 частей, 2x3
par(oma = c(0, 0, 1.5, 0)) # внешние поля общего полотна
par(mar = c(4, 4, 0.5, 0.5)) # внутренние поля каждого графика

# цикл по номерам столбцов с количественными переменными
for (i in 2:6) {
  # данные -- i-ый столбец фрейма
  x <- DFF[, i]
  
  # гистограмма
  hist(x,
       freq = F, # по вертикали – плотность (доля)
       col = 'wheat', # цвет заливки
       xlab = colnames(reg.df)[i], # ось X – название столбца
       ylab = 'Плотность', # ось Y
       main = '') # без заголовка
  
  # теоретическая плотность
  curve(dnorm(x, mean = mean(x), sd = sd(x)), col = 'darkblue',
        lwd = 2, add = TRUE)}

# общий заголовок для всех графиков
title(main = 'Гистограммы распределения показателей',
      outer = TRUE, cex = 1.5)

# вернуть настройки обратно, 1x1
par(mfrow = c(1, 1))
```

**Вывод:** Судя по гистограммам, распределения всех показателей ассиметричны по сравнению с нормальным законом

## Тест Андерсона-Дарлинга на нормальность распределения

```{r}

# применяем ко всем столбцам тест Андерсона-Дарлинга и вытаскиваем только тестовую статистику
  
# для изначальных значений
W <- sapply(DFF[, 2:6], function(x) {
  round(ad.test(x)$statistic, 4)
})
p <- sapply(DFF[, 2:6], function(x) {
  round(ad.test(x)$p.value, 4)
})
table <- data.frame(W, p)
kable(table)

```

**Вывод:** Проверяя гипотезу нормального распределения для переменных на уровне значимости 0.05, мы отвергаем все, кроме *Y.activity.2016.ps* и *Sum.activity.2015* так как остальные p-значения < 0.05 .

# Графики разброса

```{r}
# графики взаимного разброса
pairs(DFF[, -1], # фрейм без первого столбца-фактора
      pch = 21, # тип символов для точек
      col = rgb(1, 0, 1, alpha = 0.4), # цвет заливки точек
      bg = rgb(1, 0, 1, alpha = 0.4), # цвет границы точек
      cex = 1.1) # масштаб символов для точек

```
**Вывод:** по первой строке графиков попытаемся определить наличие связи между *Y.activity.2016.ps* и остальными показателями. Можно предположить, что есть положительная связь между *Y.activity.2016.ps* и *numb.employees.2016*, *Sum.activity.2015*.

# Корреляционная матрица

```{r}
# коэффициенты Пирсона с P-значениями
r.corr <- rcorr(as.matrix(DFF[, -1]))
# сохраняем корреляционную матрицу
matrix.cor <- cor(DFF[, -1])

# сохраняем p-значения
matrix.p <- rcorr(as.matrix(DFF[, -1]))$P

# изображаем матрицу графически
corrplot(matrix.cor, method = "number",        # сама корреляционная матрица
         order = 'original',  # порядок отображения показателей 
         # в матрице
         diag = F,            # не отображать значения на главной 
         # диагонали
         p.mat = matrix.p,    # p-значения
         insig = 'blank',     # метод отображения незначимых
         sig.level = 0.05)    # уровень значимости
title(ylab = 'Корреляция логарифмированных показателей')
```

**Вывод:** Взаимосвязь *Y.activity.2016.ps* значима с показателями *numb.employees.2016* и *Sum.activity.2015*

```{r}
# 5. Сохранение рабочего пространства

# сохраняем нужные объекты в файл
save(list = c('DF', 'reg.df', 'DFF'), file = './Лаб1_Горбовский.RData')
save.image('./Лаб1_Горбовский.RData')
rm()
```